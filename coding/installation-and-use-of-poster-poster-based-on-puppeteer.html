<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>åŸºäº Puppeteer ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨ | Blog</title>
    <meta name="description" content="åŸºäº Puppeteer ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨">
    
    <meta name="keywords" content="Puppeteer puppeteer æµ·æŠ¥ åˆ†äº«">
    <link rel="preload" href="/assets/css/styles.e418f3b2.css" as="style"><link rel="preload" href="/assets/js/app.e418f3b2.js" as="script"><link rel="preload" href="/assets/js/6.351126f6.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.47b44045.css"><link rel="prefetch" href="/assets/js/1.47b44045.js"><link rel="prefetch" href="/assets/css/2.styles.f515390e.css"><link rel="prefetch" href="/assets/js/2.f515390e.js"><link rel="prefetch" href="/assets/js/3.13653eae.js"><link rel="prefetch" href="/assets/js/4.ddbf7069.js"><link rel="prefetch" href="/assets/js/5.6fc87358.js">
    <link rel="stylesheet" href="/assets/css/styles.e418f3b2.css"><link rel="stylesheet" href="/assets/css/1.styles.47b44045.css"><link rel="stylesheet" href="/assets/css/2.styles.f515390e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/coding/" class="nav-link router-link-active">Coding</a></div><div class="nav-item"><a href="/photography/" class="nav-link">Photography</a></div><div class="nav-item"><a href="/guitar/" class="nav-link">Guitar</a></div><div class="nav-item"><a href="https://m809745357.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/m809745357/m809745357.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/coding/" class="nav-link router-link-active">Coding</a></div><div class="nav-item"><a href="/photography/" class="nav-link">Photography</a></div><div class="nav-item"><a href="/guitar/" class="nav-link">Guitar</a></div><div class="nav-item"><a href="https://m809745357.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/m809745357/m809745357.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>åŸºäº Puppeteer ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æ€è€ƒæ€ä¹ˆå»ç”Ÿæˆå›¾ç‰‡" class="sidebar-link">æ€è€ƒæ€ä¹ˆå»ç”Ÿæˆå›¾ç‰‡</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æœ¬åœ°éƒ¨ç½²" class="sidebar-link">æœ¬åœ°éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#å®‰è£…-puppeteer" class="sidebar-link">å®‰è£… puppeteer</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æµ‹è¯•-puppeteer" class="sidebar-link">æµ‹è¯• puppeteer</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#php-ä¸­ä½¿ç”¨-puppeteer" class="sidebar-link">php ä¸­ä½¿ç”¨ puppeteer</a></li></ul></li><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æµ‹è¯•éƒ¨ç½²" class="sidebar-link">æµ‹è¯•éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#ä¾èµ–é”™è¯¯" class="sidebar-link">ä¾èµ–é”™è¯¯</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#ç‰ˆæœ¬é”™è¯¯" class="sidebar-link">ç‰ˆæœ¬é”™è¯¯</a></li></ul></li><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#docker-éƒ¨ç½²" class="sidebar-link">Docker éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#centos-å®‰è£…-docker" class="sidebar-link">centos å®‰è£… docker</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#docker-build-å®¹å™¨" class="sidebar-link">docker build å®¹å™¨</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#åˆ›å»º-puppeteer-sh" class="sidebar-link">åˆ›å»º puppeteer.sh</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#puppeteer-sh-ç”Ÿæˆå›¾ç‰‡" class="sidebar-link">puppeteer.sh ç”Ÿæˆå›¾ç‰‡</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#php-å»è°ƒç”¨-puppeteer-sh" class="sidebar-link">php å»è°ƒç”¨ puppeteer.sh</a></li></ul></li><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æ­£å¼éƒ¨ç½²" class="sidebar-link">æ­£å¼éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#å®‰è£…-express-puppeteer-ç­‰å·¥å…·" class="sidebar-link">å®‰è£… express puppeteer ç­‰å·¥å…·</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#express-æ­å»º-api-æœåŠ¡å™¨" class="sidebar-link">express æ­å»º api æœåŠ¡å™¨</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#pm2-æ¥ç®¡ç†-express" class="sidebar-link">pm2 æ¥ç®¡ç† express</a></li><li class="sidebar-sub-header"><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#php-è°ƒç”¨æ¥å£æ¥å®ç°" class="sidebar-link">php è°ƒç”¨æ¥å£æ¥å®ç°</a></li></ul></li><li><a href="/coding/installation-and-use-of-poster-poster-based-on-puppeteer.html#æ‰©å±•åˆ†äº«" class="sidebar-link">æ‰©å±•åˆ†äº«</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="åŸºäº-puppeteer-ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨"><a href="#åŸºäº-puppeteer-ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> åŸºäº Puppeteer ç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½çš„å®‰è£…å’Œä½¿ç”¨</h1> <h2 id="æ€è€ƒæ€ä¹ˆå»ç”Ÿæˆå›¾ç‰‡"><a href="#æ€è€ƒæ€ä¹ˆå»ç”Ÿæˆå›¾ç‰‡" aria-hidden="true" class="header-anchor">#</a> æ€è€ƒæ€ä¹ˆå»ç”Ÿæˆå›¾ç‰‡</h2> <blockquote><p>ç”¨ php å¤„ç†å›¾ç‰‡çš„æ°´å°å»å®ç°ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®šä½ã€‚</p></blockquote> <blockquote><p>ç”¨ canvas å»å¤„ç† html dom èŠ‚ç‚¹ä¿å­˜è¾“å‡ºå›¾ç‰‡ï¼Œéœ€è¦å¤„ç†å®šä½ï¼Œå°ç¨‹åºåŒç†ã€‚</p></blockquote> <ul><li><a href="https://segmentfault.com/a/1190000016121303" target="_blank" rel="noopener noreferrer">è½»æ¾ç”Ÿæˆå°ç¨‹åºåˆ†äº«æµ·æŠ¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <blockquote><p>ä½¿ç”¨ js æ’ä»¶æŠŠ html è½¬æˆ canves åœ¨è½¬æˆ å›¾ç‰‡è¾“å‡º</p></blockquote> <ul><li><a href="http://html2canvas.hertzen.com/" target="_blank" rel="noopener noreferrer">html2canvas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <blockquote><p>ä½¿ç”¨ puppeteer æ— å¤´ChromeèŠ‚ç‚¹API å·¥å…·å»å®ç°ã€‚</p></blockquote> <p>å…¶å®å°±æ˜¯ç”¨è°·æ­Œæµè§ˆå™¨å»æ‰“å¼€ç½‘é¡µç„¶åæˆªå›¾ä¿å­˜åˆ°æœ¬åœ°</p> <ul><li><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener noreferrer">GoogleChrome/puppeteer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000011382062" target="_blank" rel="noopener noreferrer">centoså®‰è£…ä½¿ç”¨puppeteerå’Œheadless chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>ç»è¿‡å‰åç«¯åŒå­¦çš„ç´§å¼ è®¨è®ºä¸‹ï¼Œæœ€åå‹‡æ•¢çš„ä½¿ç”¨äº†ç¬¬4ä¸ªæ–¹æ¡ˆï¼š</p> <p>åœ¨ç¨‹åºå‘˜ç•Œæ²¡å­¦ä¹ ä¸€é¡¹æ–°çš„çŸ¥è¯†éƒ½éœ€è¦æ‰“å°ä¸€æ®µ Hello Worldï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å®ç°ç¬¬ä¸€æ­¥</p> <h2 id="æœ¬åœ°éƒ¨ç½²"><a href="#æœ¬åœ°éƒ¨ç½²" aria-hidden="true" class="header-anchor">#</a> æœ¬åœ°éƒ¨ç½²</h2> <p>é¦–å…ˆç†Ÿç»ƒçš„æ‰“å¼€äº† iterm å·¥å…·æ‰§è¡Œå‘½ä»¤</p> <h3 id="å®‰è£…-puppeteer"><a href="#å®‰è£…-puppeteer" aria-hidden="true" class="header-anchor">#</a> å®‰è£… puppeteer</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> ~/code/puppeteer <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> ~/code/puppeteer

yarn add puppeteer
</code></pre></div><p><img src="/assets/img/image-20180913185026947.e45c693c.png" alt="image-20180913185026947"></p> <p>è¿™é€šå¸¸æ˜¯ç”±äº Chromium æµè§ˆå™¨æœªæ­£å¸¸ä¸‹è½½åˆ°è€Œå¼•èµ·çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¾å®šç¯å¢ƒå˜é‡ï¼Œè·³è¿‡å®‰è£… Chromium çš„æ­¥éª¤ï¼Œç„¶åæ‰‹åŠ¨ç¿»å¢™å»ä¸‹è½½ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">set</span> PUPPETEER_SKIP_CHROMIUM_DOWNLOAD<span class="token operator">=</span>1
</code></pre></div><p>ç„¶åè¿˜éœ€è¦æ‰‹åŠ¨çš„æŒ‡å®šæ‰§è¡Œçš„ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¤šçš„å»ä»‹ç»äº†ã€‚</p> <p>ç›´æ¥åŠ¨ç”¨æ·˜å®é•œåƒï¼Œæœç„¶å¯ä»¥ï¼Œæ„Ÿè°¢é©¬çˆ¸çˆ¸ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i puppeteer
</code></pre></div><p><img src="/assets/img/image-20180913185437942.f1b6ff43.png" alt="image-20180913185437942"></p> <h3 id="æµ‹è¯•-puppeteer"><a href="#æµ‹è¯•-puppeteer" aria-hidden="true" class="header-anchor">#</a> æµ‹è¯• puppeteer</h3> <p>ç„¶åå°±æ˜¯ç”¨å®˜æ–¹æä¾›çš„æ–¹å¼æ¥æµ‹è¯•ã€‚</p> <p>åˆ›å»º example.js æ–‡ä»¶ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> example.js <span class="token operator">&amp;&amp;</span> vim example.js
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">'example.png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>node example.js
</code></pre></div><p><img src="/assets/img/image-20180913185819314.917084f4.png" alt="image-20180913185819314"></p> <p>å›¾ç‰‡æˆåŠŸçš„æ˜¾ç¤ºå‡ºæ¥äº† ğŸ˜„</p> <p><img src="/assets/img/image-20180913185856473.4b505d50.png" alt="image-20180913185856473"></p> <h3 id="php-ä¸­ä½¿ç”¨-puppeteer"><a href="#php-ä¸­ä½¿ç”¨-puppeteer" aria-hidden="true" class="header-anchor">#</a> php ä¸­ä½¿ç”¨ puppeteer</h3> <p>ç„¶åå°±æ˜¯æ”¾åˆ°PHPä»£ç é‡Œé¢ã€‚è¿™é‡Œæˆ‘å°±ç›´æ¥æˆªå–äº†éƒ¨åˆ†ä»£ç è®²ä¸€ä¸‹æ€è·¯ã€‚</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// å›¾ç‰‡ä¿å­˜åœ°å€</span>
<span class="token variable">$imgFilePath</span> <span class="token operator">=</span> <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;app/public/activity-record/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activityRecord</span><span class="token punctuation">}</span></span>_<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$template</span><span class="token punctuation">}</span></span>.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// jsä¿å­˜åœ°å€</span>
<span class="token variable">$jsFilePath</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;/public/activity-record/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activityRecord</span><span class="token punctuation">}</span></span>_<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$template</span><span class="token punctuation">}</span></span>.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// è®¿é—®åœ°å€</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'http://'</span> <span class="token punctuation">.</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'api.domains.mp'</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot;/activity/record/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activityRecord</span><span class="token punctuation">}</span></span>/share?template=<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$template</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºæ–‡ä»¶</span>
<span class="token variable">$jsFileContents</span> <span class="token operator">=</span> <span class="token heredoc-string string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOF</span>
const puppeteer = require('puppeteer');

(async () =&gt; {
const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox']});
const page = await browser.newPage();
await page.setViewport({ width: 375, height: 667, deviceScaleFactor: 2, isMobile: true });
await page.goto('<span class="token interpolation"><span class="token variable">$url</span></span>');
await page.screenshot({ path: '<span class="token interpolation"><span class="token variable">$imgFilePath</span></span>' });

await browser.close();
})();
<span class="token delimiter symbol">EOF<span class="token punctuation">;</span></span></span>

Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$jsFilePath</span><span class="token punctuation">,</span> <span class="token variable">$jsFileContents</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸»è¦ä¹Ÿå°±æ˜¯è¿™ä¸€æ­¥æ¯”è¾ƒçš„å‘ï¼Œå¡«äº†å¾ˆä¹…å¾ˆä¹…</span>
<span class="token comment">// æ­£å¼çš„ç¯å¢ƒéœ€è¦æŒ‡å®šnodeç›®å½•</span>
<span class="token comment">// exec('/usr/local/nodejs/bin/node ' . storage_path(&quot;app/$jsFilePath&quot;));</span>
<span class="token comment">// æœ¬åœ°å·²ç»å®ç°äº†</span>
<span class="token function">exec</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'node '</span> <span class="token punctuation">.</span> <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;app/<span class="token interpolation"><span class="token variable">$jsFilePath</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™é‡Œæ˜¯ä¸Šä¼ åˆ°è…¾è®¯cos</span>
<span class="token variable">$disk</span> <span class="token operator">=</span> \<span class="token package">Storage</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cosv5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$cosPath</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;jielong/activity/record/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activityRecord</span><span class="token punctuation">}</span></span>/t/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$template</span><span class="token punctuation">}</span></span>.png&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$disk</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$cosPath</span><span class="token punctuation">,</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;<span class="token interpolation"><span class="token variable">$imgFilePath</span></span>&quot;</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¥½äº†æœ¬åœ°è°ƒè¯•é€šè¿‡äº†ï¼Œé‚£å°±å¼€å§‹èµ°æµ‹è¯•ç¯å¢ƒï¼Œè¿™é‡Œå¼€å§‹å°±ä¸åœçš„å‡ºç°é—®é¢˜ï¼Œä¾èµ–é—®é¢˜ç­‰ç­‰éƒ½å‡ºæ¥äº†ã€‚</p> <h2 id="æµ‹è¯•éƒ¨ç½²"><a href="#æµ‹è¯•éƒ¨ç½²" aria-hidden="true" class="header-anchor">#</a> æµ‹è¯•éƒ¨ç½²</h2> <p>é¦–å…ˆæ˜¯æµ‹è¯•æ¢è¿› Centos 6.7 ç‰ˆæœ¬</p> <h3 id="ä¾èµ–é”™è¯¯"><a href="#ä¾èµ–é”™è¯¯" aria-hidden="true" class="header-anchor">#</a> ä¾èµ–é”™è¯¯</h3> <h4 id="libxcomposite-so-1"><a href="#libxcomposite-so-1" aria-hidden="true" class="header-anchor">#</a> libXcomposite.so.1</h4> <blockquote><p>error while loading shared libraries: libXcomposite.so.1: cannot open shared object file: No such file or directory</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>/home/puppeteer/node_modules/puppeteer/.local-chromium/linux-588429/chrome-linux/chrome: error <span class="token keyword">while</span> loading shared libraries: libXcomposite.so.1: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
</code></pre></div><p><img src="/assets/img/image-20180914124705842.16ee0ab3.png" alt="image-20180914124705842"></p> <p><a href="https://github.com/GoogleChrome/puppeteer/issues/560#issuecomment-325224766" target="_blank" rel="noopener noreferrer">issuess<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>// å®‰è£…ä¾èµ–
yum <span class="token function">install</span> pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 -y

// å®‰è£…å­—ä½“
yum <span class="token function">install</span> ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc -y
</code></pre></div><h4 id="libatk-bridge-2-0-so-0"><a href="#libatk-bridge-2-0-so-0" aria-hidden="true" class="header-anchor">#</a> libatk-bridge-2.0.so.0</h4> <blockquote><p>error while loading shared libraries: libatk-bridge-2.0.so.0: cannot open shared object file: No such file or directory</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>/home/puppeteer/node_modules/puppeteer/.local-chromium/linux-588429/chrome-linux/chrome: error <span class="token keyword">while</span> loading shared libraries: libatk-bridge-2.0.so.0: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
</code></pre></div><p><img src="/assets/img/image-20180914125130578.4ab92e91.png" alt="image-20180914125130578"></p> <div class="language-bash extra-class"><pre class="language-bash"><code>ldd node_modules/puppeteer/.local-chromium/linux-588429/chrome-linux/chrome
</code></pre></div><p><img src="/assets/img/image-20180914130912067.0a1994d7.png" alt="image-20180914130912067"></p> <div class="language-bash extra-class"><pre class="language-bash"><code>// ç½‘ä¸Šå‘ç°äº†ä¸€ä¸ªæ–¹å¼ï¼Œå®‰è£…ä¸€ä¸ª firefox ç„¶åæŠŠä¾èµ–å¤åˆ¶è¿‡å»
yum <span class="token function">install</span> firefox-60.1.0-6.el6.centos.x86_64

<span class="token function">cp</span> /usr/lib64/firefox/bundled/lib64/libatk-bridge-2.0.so.0 /usr/lib64
<span class="token function">cp</span> /usr/lib64/firefox/bundled/lib64/libatspi.so.0 /usr/lib64
<span class="token function">cp</span> /usr/lib64/firefox/bundled/lib64/libgdk-3.so.0 /usr/lib64
<span class="token function">cp</span> /usr/lib64/firefox/bundled/lib64/libgtk-3.so.0 /usr/lib64
</code></pre></div><p><img src="/assets/img/image-20180914133816963.287553f5.png" alt="image-20180914133816963"></p> <h4 id="libgl-so-1"><a href="#libgl-so-1" aria-hidden="true" class="header-anchor">#</a> libGL.so.1</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>/home/puppeteer/node_modules/puppeteer/.local-chromium/linux-588429/chrome-linux/chrome: error <span class="token keyword">while</span> loading shared libraries: libGL.so.1: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> mesa-libGL.x86_64
</code></pre></div><p><img src="/assets/img/image-20180914133937739.9375e121.png" alt="image-20180914133937739"></p> <p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤è¡Œå¯ä»¥çœ‹åˆ°éœ€è¦ GLIBC_2.14 GLIBC_2.16</p> <div class="language-bash extra-class"><pre class="language-bash"><code>objdump -p node_modules/puppeteer/.local-chromium/linux-588429/chrome-linux/chrome
</code></pre></div><p><img src="/assets/img/image-20180914132319923.fd90b0fe.png" alt="image-20180914132319923"></p> <p>å‘ç°åªæ”¯æŒåˆ° GLIBC_2.12</p> <div class="language-bash extra-class"><pre class="language-bash"><code>strings /lib64/libc.so.6 <span class="token operator">|</span><span class="token function">grep</span> GLIBC_ 
</code></pre></div><p><img src="/assets/img/image-20180914132530077.b26f575d.png" alt="image-20180914132530077"></p> <p>æ‰€ä»¥éœ€è¦å®‰è£… GLIBC_2.14</p> <p><a href="https://www.cnblogs.com/kevingrace/p/8744417.html" target="_blank" rel="noopener noreferrer">libc.so.6: version 'GLIBC_2.14' not foundæŠ¥é”™æç¤ºçš„è§£å†³æ–¹æ¡ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ä½†æ˜¯GLIBC_2.16åœ¨æœºå™¨ä¸Šæ€ä¹ˆè£…éƒ½è£…ä¸ä¸Šï¼Œæ‰€ä»¥åæ¥æ”¾å¼ƒäº†ã€‚</p> <p>è§£å†³æ–¹æ¡ˆæ˜¯å®‰è£…ä½ç‰ˆæœ¬çš„puppeteer å¤§æ¦‚æ˜¯ 1.4 ä»¥ä¸‹çš„ç‰ˆæœ¬</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i puppeteer@1.4
</code></pre></div><p>å¥½åƒæ²¡æœ‰æ‰¾åˆ°ä¸éœ€è¦ GLIBC_2.14 çš„åŒ…</p> <p>æœ€åæ˜¯å®‰è£…äº† GLIBC_2.14 ç„¶åæ‰§è¡Œå‘½ä»¤ä¹‹åå‘ç°äº†ä¸€ä¸ªé—®é¢˜ã€‚</p> <h3 id="ç‰ˆæœ¬é”™è¯¯"><a href="#ç‰ˆæœ¬é”™è¯¯" aria-hidden="true" class="header-anchor">#</a> ç‰ˆæœ¬é”™è¯¯</h3> <h4 id="libcairo-gobject-so-2-undefined-symbol-cairo-region-destroy"><a href="#libcairo-gobject-so-2-undefined-symbol-cairo-region-destroy" aria-hidden="true" class="header-anchor">#</a> libcairo-gobject.so.2: undefined symbol: cairo_region_destroy</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>libcairo-gobject.so.2: undefined symbol: cairo_region_destroy
</code></pre></div><p>åé¢åæ­£æ˜¯æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p> <h2 id="docker-éƒ¨ç½²"><a href="#docker-éƒ¨ç½²" aria-hidden="true" class="header-anchor">#</a> Docker éƒ¨ç½²</h2> <h3 id="centos-å®‰è£…-docker"><a href="#centos-å®‰è£…-docker" aria-hidden="true" class="header-anchor">#</a> centos å®‰è£… docker</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> docker-io
<span class="token function">service</span> docker start
vim Dockerfile
</code></pre></div><h3 id="docker-build-å®¹å™¨"><a href="#docker-build-å®¹å™¨" aria-hidden="true" class="header-anchor">#</a> docker build å®¹å™¨</h3> <div class="language-dockerfile extra-class"><pre class="language-text"><code>FROM node:8-slim

# See https://crbug.com/795759
RUN apt-get update &amp;&amp; apt-get install -yq libgconf-2-4

# Install latest chrome dev package and fonts to support major charsets (Chinese, Japanese, Arabic, Hebrew, Thai and a few others)
# Note: this installs the necessary libs to make the bundled version of Chromium that Puppeteer
# installs, work.
RUN apt-get update &amp;&amp; apt-get install -y wget --no-install-recommends \
    &amp;&amp; wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | apt-key add - \
    &amp;&amp; sh -c 'echo &quot;deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main&quot; &gt;&gt; /etc/apt/sources.list.d/google.list' \
    &amp;&amp; apt-get update \
    &amp;&amp; apt-get install -y google-chrome-unstable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst ttf-freefont \
      --no-install-recommends \
    &amp;&amp; rm -rf /var/lib/apt/lists/* \
    &amp;&amp; apt-get purge --auto-remove -y curl \
    &amp;&amp; rm -rf /src/*.deb

# It's a good idea to use dumb-init to help prevent zombie chrome processes.
ADD https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64 /usr/local/bin/dumb-init
RUN chmod +x /usr/local/bin/dumb-init

# Uncomment to skip the chromium download when installing puppeteer. If you do,
# you'll need to launch puppeteer with:
#     browser.launch({executablePath: 'google-chrome-unstable'})
# ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD true

# Install puppeteer so it's available in the container.
RUN npm i puppeteer

# Add user so we don't need --no-sandbox.
RUN groupadd -r pptruser &amp;&amp; useradd -r -g pptruser -G audio,video pptruser \
    &amp;&amp; mkdir -p /home/pptruser/Downloads \
    &amp;&amp; chown -R pptruser:pptruser /home/pptruser \
    &amp;&amp; chown -R pptruser:pptruser /node_modules

# Run everything after as non-privileged user.
USER pptruser

ENTRYPOINT [&quot;dumb-init&quot;, &quot;--&quot;]
CMD [&quot;google-chrome-unstable&quot;]
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t puppeteer-chrome-linux <span class="token keyword">.</span>
</code></pre></div><h3 id="åˆ›å»º-puppeteer-sh"><a href="#åˆ›å»º-puppeteer-sh" aria-hidden="true" class="header-anchor">#</a> åˆ›å»º puppeteer.sh</h3> <p>ç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ puppeteer.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token function">readonly</span> USAGE<span class="token operator">=</span><span class="token string">&quot;Usage: puppeteer.sh yourfile.js&quot;</span>

basepath<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>

local_path<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$basepath</span>/storage/app/public/activity-record/&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token keyword">echo</span> <span class="token string">&quot;File not specified.&quot;</span>
  <span class="token keyword">echo</span> <span class="token variable">$USAGE</span>
  <span class="token keyword">exit</span> 0
<span class="token keyword">fi</span>

<span class="token keyword">echo</span> <span class="token string">&quot;Running <span class="token variable">$1</span> in Puppeteer...&quot;</span>

file<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $1<span class="token variable">`</span></span>

<span class="token comment"># set -x # debug on</span>
docker run -it --net<span class="token operator">=</span>host -v <span class="token variable">$local_path</span>:/home/pptruser/Downloads --privileged<span class="token operator">=</span>true --rm --cap-add<span class="token operator">=</span>SYS_ADMIN \
  --name puppeteer-chrome puppeteer-chrome-linux \
  node -e <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span>
</code></pre></div><h3 id="puppeteer-sh-ç”Ÿæˆå›¾ç‰‡"><a href="#puppeteer-sh-ç”Ÿæˆå›¾ç‰‡" aria-hidden="true" class="header-anchor">#</a> puppeteer.sh ç”Ÿæˆå›¾ç‰‡</h3> <p>ä½¿ç”¨ puppeteer.sh æ¥è°ƒç”¨ example.js</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./puppeteer.sh example.js
</code></pre></div><h3 id="php-å»è°ƒç”¨-puppeteer-sh"><a href="#php-å»è°ƒç”¨-puppeteer-sh" aria-hidden="true" class="header-anchor">#</a> php å»è°ƒç”¨ puppeteer.sh</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">exec</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;./puppeteer.sh example.js&quot;</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ€è€ƒ: php å¦‚ä½•ä½¿ç”¨ root æƒé™</p></blockquote> <p>ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨å‘½ä»¤è¡Œçš„æ—¶å€™æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œä½†æ˜¯åœ¨ç½‘é¡µä¸Šé¢æ˜¯ä¸è¡Œï¼Œæœ€åå‘ç°æ˜¯æƒé™é—®é¢˜ã€‚å‘½ä»¤è¡Œæ˜¯ root æƒé™ä½†æ˜¯åœ¨ç½‘ç«™çš„æ—¶å€™æ˜¯ www æƒé™ï¼Œå› ä¸ºæƒé™æ˜¯é€šè¿‡ nginx çš„ç”¨æˆ·æ¥å®šçš„ã€‚ç„¶ååˆæƒ³åˆ°ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨é˜Ÿåˆ—æ‰§è¡Œï¼Œé˜Ÿåˆ—æ˜¯å¯ä»¥ä½¿ç”¨ root æƒé™å»æ‰§è¡Œçš„ï¼Œæ²¡æƒ³åˆ°æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯é˜Ÿåˆ—è·å–ä¸åˆ°é˜Ÿåˆ—æ‰§è¡Œçš„ç»“æœï¼Œæ‰€ä»¥æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡å°±ä¸èƒ½ç”¨äº†ï¼Œéœ€è¦æ‰‹åŠ¨çš„é‡å¯é˜Ÿåˆ—ï¼Œæœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ã€‚</p> <h2 id="æ­£å¼éƒ¨ç½²"><a href="#æ­£å¼éƒ¨ç½²" aria-hidden="true" class="header-anchor">#</a> æ­£å¼éƒ¨ç½²</h2> <p>Centos 7.4 ä¸€åˆ‡æ²¡æœ‰é—®é¢˜ã€‚</p> <p>ä¸»è¦æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œç”Ÿæˆå›¾ç‰‡çš„æ—¶å€™æ–‡å­—æœ‰æ–¹æ ¼ä¹±ç ï¼Œè§£å†³çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨æœ¬åœ°çš„å­—ä½“åº“ã€‚</p> <p>ç›®å‰ä½¿ç”¨é˜Ÿåˆ—æ¥æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æ— æ³•å®æ—¶çš„æ›´æ–°ï¼Œæ‰€ä»¥å°è¯• sleep æ–¹æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <p>æ€è€ƒå node express å¼€å‘ä¸€ä¸ª api æ¥ç”Ÿæˆå›¾ç‰‡ã€‚</p> <h3 id="å®‰è£…-express-puppeteer-ç­‰å·¥å…·"><a href="#å®‰è£…-express-puppeteer-ç­‰å·¥å…·" aria-hidden="true" class="header-anchor">#</a> å®‰è£… express puppeteer ç­‰å·¥å…·</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /home/www/puppeteer
<span class="token function">cd</span> /home/www/puppeteer
// chrome æ— å¤´
cnpm i puppeteer
// è…¾è®¯cos
cnpm i cos-nodejs-sdk-v5 --save
// express
cnpm i express
// ç¯å¢ƒå˜é‡
cnpm i dotenv
// pm2è¿›ç¨‹ç®¡ç†
cnpm <span class="token function">install</span> pm2 -g
</code></pre></div><h3 id="express-æ­å»º-api-æœåŠ¡å™¨"><a href="#express-æ­å»º-api-æœåŠ¡å™¨" aria-hidden="true" class="header-anchor">#</a> express æ­å»º api æœåŠ¡å™¨</h3> <p>index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å¼•å…¥jsonè§£æä¸­é—´ä»¶</span>
<span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cos-nodejs-sdk-v5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> basePath <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> dotenv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>basePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../jielong_mp/.env`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">COS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    AppId<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_APP_ID</span><span class="token punctuation">,</span>
    SecretId<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_SECRET_ID</span><span class="token punctuation">,</span>
    SecretKey<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_SECRET_KEY</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// COSV5_APP_ID = 1251581441</span>
<span class="token comment">// COSV5_SECRET_ID = AKIDbFnBPV9N6g8PYY91TkJp6D92pT0NIpoc</span>
<span class="token comment">// COSV5_SECRET_KEY = mOp9MRMF2eN0Tq26zhEaZO3XsJk3CA1i</span>
<span class="token comment">// COSV5_TIMEOUT = 60</span>
<span class="token comment">// COSV5_CONNECT_TIMEOUT = 60</span>
<span class="token comment">// COSV5_BUCKET = kemanyun</span>
<span class="token comment">// COSV5_REGION = ap - shanghai</span>
<span class="token comment">// COSV5_CDN = #https://{your-bucket-name}-{your-app-id}.file.myqcloud.com</span>
<span class="token comment">// COSV5_SCHEME = https</span>

<span class="token comment">// æ·»åŠ jsonè§£æ</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/puppeteer'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> activity_record_id <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>activity_record_id<span class="token punctuation">;</span>
    <span class="token keyword">const</span> template <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>template<span class="token punctuation">;</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>basePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../jielong_mp/storage/app/public/activity-record/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>activity_record_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> mp_domain <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MP_DOMAIN</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`http:/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mp_domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/activity/record/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>activity_record_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/share?template=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span> <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_ENV</span> <span class="token operator">===</span> <span class="token string">'local'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">375</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">667</span><span class="token punctuation">,</span> deviceScaleFactor<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> isMobile<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> path <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ†ç‰‡ä¸Šä¼ </span>
        <span class="token keyword">await</span> cos<span class="token punctuation">.</span><span class="token function">sliceUploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            Bucket<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_BUCKET</span><span class="token punctuation">,</span>
            Region<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_REGION</span><span class="token punctuation">,</span>
            Key<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COSV5_BUCKET_PREFIX</span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`/activity/record/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>activity_record_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/t/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png`</span></span><span class="token punctuation">,</span>
            FilePath<span class="token punctuation">:</span> path
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            message<span class="token punctuation">:</span> <span class="token string">'åˆ›å»ºå›¾ç‰‡æˆåŠŸ'</span><span class="token punctuation">,</span>
            status_code<span class="token punctuation">:</span> <span class="token string">'201'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Example app listening on port 3000!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="pm2-æ¥ç®¡ç†-express"><a href="#pm2-æ¥ç®¡ç†-express" aria-hidden="true" class="header-anchor">#</a> pm2 æ¥ç®¡ç† express</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 start index.js
</code></pre></div><p><img src="/assets/img/image-20180914140355472.15404fd7.png" alt="image-20180914140355472"></p> <h3 id="php-è°ƒç”¨æ¥å£æ¥å®ç°"><a href="#php-è°ƒç”¨æ¥å£æ¥å®ç°" aria-hidden="true" class="header-anchor">#</a> php è°ƒç”¨æ¥å£æ¥å®ç°</h3> <div class="language-php extra-class"><pre class="language-php"><code>
<span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token variable">$guzzleCLient</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$guzzleCLient</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://127.0.0.1:3000/api/puppeteer'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'activity_record_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$activityRecord</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'template'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$template</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="æ‰©å±•åˆ†äº«"><a href="#æ‰©å±•åˆ†äº«" aria-hidden="true" class="header-anchor">#</a> æ‰©å±•åˆ†äº«</h2> <p>æœ€åæˆ‘æ‰å‘ç°äº†å·²ç»æœ‰å¤§ç¥æœ‰è§£å†³æ–¹æ¡ˆäº†ï¼Œå¹²å¾—æ¼‚äº®ã€‚</p> <p><a href="https://github.com/nesk/rialto" target="_blank" rel="noopener noreferrer">nesk/rialto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å·¥ä½œåŸç†æ˜¯åˆ›å»ºä¸€ä¸ªNodeè¿›ç¨‹å¹¶é€šè¿‡ socket ä¸å®ƒé€šä¿¡ã€‚</p> <p><a href="https://laravel-china.org/topics/14699/extended-recommendation-php-bridge-of-puphpeteerchrome-headless-browser-puphpeteer-project" target="_blank" rel="noopener noreferrer">Puphpeteerï¼šChrome æ— å¤´æµè§ˆå™¨ Puphpeteer é¡¹ç›®çš„ PHP æ¡¥æ¢<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ç›®å‰çº¿ä¸Šä½¿ç”¨æ¥å£ï¼Œæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªåŒ…</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/6.351126f6.js" defer></script><script src="/assets/js/app.e418f3b2.js" defer></script>
  </body>
</html>
